const Web3 = require("web3");

const web3 = new Web3(
  new Web3.providers.WebsocketProvider("http://127.0.0.1:7545")
);

const abi = [
  {
    constant: false,
    inputs: [
      {
        name: "_pokemonType",
        type: "uint8",
      },
    ],
    name: "catchPokemon",
    outputs: [],
    payable: false,
    stateMutability: "nonpayable",
    type: "function",
  },
  {
    anonymous: false,
    inputs: [
      {
        indexed: true,
        name: "playerAddress",
        type: "address",
      },
      {
        indexed: true,
        name: "pokemonType",
        type: "uint8",
      },
    ],
    name: "PokemonCatched",
    type: "event",
  },
  {
    constant: true,
    inputs: [
      {
        name: "_playerAddress",
        type: "address",
      },
    ],
    name: "listCatchedPokemons",
    outputs: [
      {
        name: "",
        type: "uint8[]",
      },
    ],
    payable: false,
    stateMutability: "view",
    type: "function",
  },
  {
    constant: true,
    inputs: [
      {
        name: "_pokemonType",
        type: "uint8",
      },
    ],
    name: "listPokemonHolders",
    outputs: [
      {
        name: "",
        type: "address[]",
      },
    ],
    payable: false,
    stateMutability: "view",
    type: "function",
  },
];

const bytecode =
  "608060405234801561001057600080fd5b50610767806100206000396000f300608060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063d6398e981461005c578063f078e1ff146100e1578063fd3c783a14610179575b600080fd5b34801561006857600080fd5b5061008a600480360381019080803560ff1690602001909291905050506101a9565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156100cd5780820151818401526020810190506100b2565b505050509050019250505060405180910390f35b3480156100ed57600080fd5b50610122600480360381019080803573ffffffffffffffffffffffffffffffffffffffff16906020019092919050505061025b565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b8381101561016557808201518184015260208101905061014a565b505050509050019250505060405180910390f35b34801561018557600080fd5b506101a7600480360381019080803560ff169060200190929190505050610322565b005b6060600160008360038111156101bb57fe5b60ff1660ff16815260200190815260200160002080548060200260200160405190810160405280929190818152602001828054801561024f57602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311610205575b50505050509050919050565b60606000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000180548060200260200160405190810160405280929190818152602001828054801561031657602002820191906000526020600020906000905b82829054906101000a900460ff1660038111156102f057fe5b815260200190600101906020826000010492830192600103820291508084116102d75790505b50505050509050919050565b42600f6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201540111151515610404576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260358152602001807f596f752063616e206f6e6c7920706572666f726d207468697320616374696f6e81526020017f206f6e636520706572203135207365636f6e647321000000000000000000000081525060400191505060405180910390fd5b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101600082600381111561045357fe5b60ff1660ff16815260200190815260200160002060009054906101000a900460ff16151515610510576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b8152602001807f596f75206861766520616c72656164792068617665207468697320747970652081526020017f6f6620706f6b656d6f6e2100000000000000000000000000000000000000000081525060400191505060405180910390fd5b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000181908060018154018082558091505090600182039060005260206000209060209182820401919006909192909190916101000a81548160ff0219169083600381111561059957fe5b02179055505060016000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160008360038111156105f057fe5b60ff1660ff16815260200190815260200160002060006101000a81548160ff021916908315150217905550426000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201819055506001600082600381111561067157fe5b60ff1660ff1681526020019081526020016000203390806001815401808255809150509060018203906000526020600020016000909192909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550508060038111156106f557fe5b3373ffffffffffffffffffffffffffffffffffffffff167f07b2ab811501b733470700af2ab6669ff492430b46be0dc9f1b2e8ec227dd1e260405160405180910390a3505600a165627a7a723058205aa02d2ad085b7971cab7cb04013292fe2fd08831780786a41a27ab4e43c6a860029";

const pokemonContract = new web3.eth.Contract(abi, undefined, {
  data: bytecode,
});

web3.eth.getAccounts().then((allAccounts) => {
  const mainAccount = allAccounts[0];

  pokemonContract
    .deploy()
    .send({
      from: mainAccount,
      gasPrice: 875_000_000,
      gas: 1_500_000,
    })
    .then((contractInstance) => {
      console.log(
        `New contract instance address: ${contractInstance.options.address}`
      );
    });
});
